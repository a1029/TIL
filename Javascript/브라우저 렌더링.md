
# 2021-09-18

## 브라우저 렌더링 과정

- 파싱, 렌더링
- Load HTML => Parse => DOM tree => Render tree => Paint
- Load CSS => Parse => CSSOM tree => Render tree => Paint
- Load Javascript => Parse => Syntax tree => Bytecode => Execute


## HTTP 1.1, HTTP 2.0
- HTTP/1.1은 다중 요청/응답이 불가능
- HTTP/2.0은 다중 요청/응답이 가능

## HTML 파싱과 DOM 생성
- HTML 문서는 문자열로 이루어진 순수한 텍스트
- 브라우저가 이해할 수 있는 자료구조(객체)로 변환하여 메모리에 저장
- 브라우저 렌더링 엔진은 HTML 문서를 파싱하여 **DOM**을 생성
- 토큰으로 분해, 노드 생성(문서 노드, 요소 노드, 어트리뷰트 노드, 텍스트 노드)

## CSS 파싱과 CSSOM 생성
- HTML을 파싱하면서 DOM을 생성해 나가다가 CSS를 로드하는 태그를 만나면 DOM 생성을 일시 중지
- HTML과 동일한 파싱 과정을 거치며 **CSSOM** 생성

## 렌더 트리 생성
- 생성한 DOM과 CSSOM은 렌더링을 위해 **렌더 트리**로 결합
- 렌더 트리는 렌더링을 위한 트리 자료 구조로서, 브라우저 화면에 렌더링되지 않는 노드(meta, script 태그 등), CSS에 의해 표시되지 않는 노드(display: none)들은 포함하지 않음
- 완성된 렌더 트리는 HTML 요소의 레이아웃을 계산하는 데 사용되며 브라우저 화면에 픽셀을 렌더링하는 페인팅 처리에 입력됨
- 자바스크립트에 의한 노드 추가/삭제, 브라우저 창의 리사이징, 노드 위치를 변경시키는 스타일 변경 같은 과정은 레이아웃 계산과 페인팅을 재차 실행시킴

## 자바스크립트 파싱과 실행
- 자바스크립트 파싱과 실행은 브라우저의 렌더링 엔진이 아닌 자바스크립트 엔진이 처리
- 자바스크립트를 해석하여 **AST(추상적 구문 트리)**를 생성
- 그리고 AST를 기반으로 인터프리터가 실행할 수 있는 바이트코드를 생성하고 실행
- 토크나이징 : 자바스크립트 소스코드를 어휘 분석(렉시컬 분석)하여 토큰으로 분해
- 파싱 : 토큰들의 집합을 구문 분석(시맨틱 분석)하여 AST 생성
- 바이트코드 생성과 실행 : AST는 인터프리터가 실행할 수 있는 바이트코드로 변환되고 인터프리터에 의해 실행

## 리플로우와 리페인트
- 자바스크립트 코드에 DOM API가 사용된 경우 DOM이나 CSSOM이 변경됨
- 이때 변경된 DOM과 CSSOM은 다시 렌더 트리로 결합되고 변경된 렌더 트리를 기반으로 레이아웃과 페인트 과정을 거쳐 브라우저의 화면에 다시 렌더링. 이를 리플로우, 리페인트라 함

## 자바스크립트 파싱에 의한 HTLM 파싱 중단
- 브라우저는 동기적으로 코드를 파싱
- script 태그의 위치는 중요한 의미를 가짐
- script 태그의 async/defer 속성
  - async : 비동기지만 DOM이 생성되기 전에 실행됨
  - defer : 비동기지만 DOM 생성이 완료되고 실행됨